<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Game Lobby</title>
<style>
    body {
        font-family: Arial, sans-serif;
        text-align: center;
    }
    .container {
        margin-top: 50px;
    }
    .nickname-input {
        display: none;
    }
</style>
</head>
<body>

<div class="container">
    <h2>Welcome to the Game Lobby</h2>
    <button id="create-lobby">Create Lobby</button>
    <button id="join-lobby">Join Lobby</button>

    <div id="lobby" style="display:none;">
        <p id="lobby-info"></p>
        <input type="text" id="nickname" class="nickname-input" placeholder="Enter your nickname">
        <button id="start-game" style="display:none;">Start Game</button>
    </div>
</div>

<script>
    let lobbyCode;
    let nicknames = [];
    let isHost = false;
    let gameStarted = false;
    let round = 1;
    let players = [];

    document.getElementById("create-lobby").addEventListener("click", function() {
        lobbyCode = generateLobbyCode();
        document.getElementById("lobby-info").innerText = "Your lobby code is: " + lobbyCode;
        document.getElementById("lobby").style.display = "block";
        isHost = true;
    });

    document.getElementById("join-lobby").addEventListener("click", function() {
        lobbyCode = prompt("Enter the lobby code:");
        if (lobbyCode) {
            document.getElementById("nickname").style.display = "block";
            document.getElementById("lobby").style.display = "block";
            document.getElementById("start-game").style.display = "none"; // Hide start game button until nickname is entered
        }
        isHost = false;
    });

    document.getElementById("start-game").addEventListener("click", function() {
        if (players.length < 2) {
            alert("Need at least two players to start the game!");
            return;
        }
        startGame();
    });

    document.getElementById("nickname").addEventListener("change", function() {
        const nickname = document.getElementById("nickname").value;
        if (nickname) {
            nicknames.push(nickname);
            players.push({
                nickname: nickname,
                points: 0
            });
            if (isHost) {
                document.getElementById("lobby-info").innerText = "Players in the lobby: " + nicknames.join(", ");
                if (nicknames.length >= 2) {
                    document.getElementById("start-game").style.display = "block";
                }
            } else {
                document.getElementById("lobby-info").innerText = "Waiting for the host to start the game";
            }
        }
    });

    function generateLobbyCode() {
        // Generate a random 4-digit lobby code
        return Math.floor(1000 + Math.random() * 9000);
    }

    function startGame() {
        gameStarted = true;
        document.getElementById("start-game").style.display = "none";
        document.getElementById("lobby-info").innerText = "Game Started!";
        playRound();
    }

    function playRound() {
        // Display countdown
        document.getElementById("lobby-info").innerText = "Game Starting in 3...";
        setTimeout(function() {
            document.getElementById("lobby-info").innerText = "Game Starting in 2...";
            setTimeout(function() {
                document.getElementById("lobby-info").innerText = "Game Starting in 1...";
                setTimeout(function() {
                    document.getElementById("lobby-info").innerText = "Red Screen!";
                    document.body.style.backgroundColor = "red";
                    setTimeout(function() {
                        document.getElementById("lobby-info").innerText = "Green Screen!";
                        document.body.style.backgroundColor = "green";
                        setTimeout(function() {
                            document.getElementById("lobby-info").innerText = "Shake or Press Space!";
                            document.body.style.backgroundColor = "white"; // Change background back to white
                            // Add event listener for shake or space press
                            window.addEventListener("keydown", handleKeyPress);
                            window.addEventListener("devicemotion", handleShake);
                        }, getRandomTime());
                    }, 3000);
                }, 1000);
            }, 1000);
        }, 1000);
    }

    function handleKeyPress(event) {
        if (event.keyCode === 32) { // Space key
            handleWin();
        }
    }

    function handleShake(event) {
        // You can implement shake detection logic here
        // For simplicity, let's assume shaking always leads to winning
        handleWin();
    }

    function handleWin() {
        // Remove event listeners to prevent multiple wins
        window.removeEventListener("keydown", handleKeyPress);
        window.removeEventListener("devicemotion", handleShake);
        const winnerIndex = Math.floor(Math.random() * players.length);
        players[winnerIndex].points += 10;
        document.getElementById("lobby-info").innerText = players[winnerIndex].nickname + " wins this round!";
        if (round < 4) {
            round++;
            setTimeout(playRound, 2000); // Wait 2 seconds before starting next round
        } else {
            endGame();
        }
    }

    function endGame() {
        let winner = players[0];
        for (let i = 1; i < players.length; i++) {
            if (players[i].points > winner.points) {
                winner = players[i];
            }
        }
        alert("Game Over! Winner: " + winner.nickname);
    }

    function getRandomTime() {
        return Math.floor(Math.random() * 5000) + 2000;
    }
</script>

</body>
</html>
